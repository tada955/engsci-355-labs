<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.554">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ENGSCI 355 Labs - 1&nbsp; Jaamsim – Radiology Clinic Lab</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../../site_libs/clipboard/clipboard.min.js"></script>
<script src="../../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../../site_libs/quarto-search/fuse.min.js"></script>
<script src="../../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../../">
<link href="../../chapters/lab_1_cm/lab_1_cm.html" rel="next">
<link href="../../index.html" rel="prev">
<script src="../../site_libs/quarto-html/quarto.js"></script>
<script src="../../site_libs/quarto-html/popper.min.js"></script>
<script src="../../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../../site_libs/quarto-html/anchor.min.js"></script>
<link href="../../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.js"></script>
<link href="../../site_libs/quarto-contrib/pseudocode-2.4.1/pseudocode.min.css" rel="stylesheet">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="../../styles.css">
</head>

<body class="nav-sidebar floating slimcontent">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../../chapters/lab_1/lab_1.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Jaamsim – Radiology Clinic Lab</span></a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../../">ENGSCI 355 Labs</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/lab_1/lab_1.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Jaamsim – Radiology Clinic Lab</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/lab_1_cm/lab_1_cm.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Radiology Clinic Lab – Conceptual Model</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../../chapters/lab_2/lab_2.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">Summary</span></span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#experiments" id="toc-experiments" class="nav-link active" data-scroll-target="#experiments"><span class="header-section-number">1.1</span> Experiments</a></li>
  <li><a href="#jaamsim-model" id="toc-jaamsim-model" class="nav-link" data-scroll-target="#jaamsim-model"><span class="header-section-number">1.2</span> Jaamsim Model</a>
  <ul class="collapse">
  <li><a href="#creating-model-objects" id="toc-creating-model-objects" class="nav-link" data-scroll-target="#creating-model-objects"><span class="header-section-number">1.2.1</span> Creating Model Objects</a></li>
  <li><a href="#configuring-objects" id="toc-configuring-objects" class="nav-link" data-scroll-target="#configuring-objects"><span class="header-section-number">1.2.2</span> Configuring Objects</a></li>
  </ul></li>
  <li><a href="#model-logic-java" id="toc-model-logic-java" class="nav-link" data-scroll-target="#model-logic-java"><span class="header-section-number">1.3</span> Model Logic – Java</a></li>
  <li><a href="#model-output" id="toc-model-output" class="nav-link" data-scroll-target="#model-output"><span class="header-section-number">1.4</span> Model Output</a></li>
  <li><a href="#task" id="toc-task" class="nav-link" data-scroll-target="#task"><span class="header-section-number">1.5</span> Task</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content page-columns page-full" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Jaamsim – Radiology Clinic Lab</span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<p>In this lab you will be introduced to the basics of creating a simulation model using the discrete event simulation software Jaamsim and the HCCM module. To do this we will use the CT service of a radiology clinic as an example. At the clinic patients: arrive according to a known distribution 24/7; check in at reception, which takes a uniformly distributed amount of time; and then have a scan, the duration of which also follows a known distribution; and finally leave.</p>
<p>We want to use the simulation to determine the average time that patients spend in the clinic, between arriving and leaving. We want to compare this time to the time that patients would spend in the system if interarrival times and scan durations were always equal to the average of the distributions for all patients. Typically we would first formulate the simulation model by defining the objectives, benefits, conceptual model, and experiments. For the sake of brevity we will only cover the experiments. As the aim of the lab is to learn the basics of Jaamsim, the conceptual model is not given here, instead it is available separately in the file Radiology_Lab_1_CM.pdf.</p>
<section id="experiments" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="experiments"><span class="header-section-number">1.1</span> Experiments</h2>
<p>We will perform just one experiment, using distributions for the arrival, check in, and scan processes. We will use a Poisson distribution with <span class="math inline">\(\lambda=8/\text{hour}\)</span> for the arrival process, a uniform distribution between 2 and 5 minutes for the check in durations, and a log-normal distribution where the underlying normal variable has a mean of -1.34 and standard deviation 0.29 for the scan durations. For the experiment we will run 50 replications that each last for 1 week.</p>
</section>
<section id="jaamsim-model" class="level2 page-columns page-full" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="jaamsim-model"><span class="header-section-number">1.2</span> Jaamsim Model</h2>
<section id="creating-model-objects" class="level3 page-columns page-full" data-number="1.2.1">
<h3 data-number="1.2.1" class="anchored" data-anchor-id="creating-model-objects"><span class="header-section-number">1.2.1</span> Creating Model Objects</h3>
<p>Run Jaamsim by opening Eclipse and the clicking the run button and select GUIFrame. The HCCM palette on the left hand side allows us to create Jaamsim objects that correspond to the components of our HCCM conceptual models. Based on the problem description and conceptual model we need three types of entities: patients, receptionists, and CT Machines. To create each of these expand the HCCM palette in the Model Builder window, select ActiveEntity, and dragging it into the View Window, see <a href="#fig-ent_pic" class="quarto-xref">Figure&nbsp;<span>1.1</span></a>. Then in the Object Selector window select ActiveEntity1, press F2, and rename it <code>PatientEntity</code>.</p>

<div class="no-row-height column-margin column-container"><div id="fig-ent_pic" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-ent_pic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/entity_creation.png" style="height:75mm" class="figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-ent_pic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.1: Screenshot of an ActiveEntity
</figcaption>
</figure>
</div></div><p>Repeat this process two more times and create ActiveEntities called <code>ReceptionistEntity</code> and <code>CTMachineEntity</code>.</p>
<p>An ActiveEntity object by itself does not create any entities in the simulation, it just acts as a prototype for entities. To create entities an ArriveEvent object is used, which simulates patients/receptionists/CTMachines arriving at the clinic. The ArriveEvent object creates a series of entities that are passed to the next object in a process. The PrototypeEntity keyword identifies the entity to be copied. The rate at which entities are generated is determined by the InterArrivalTime and FirstArrivalTime keywords. Create three ArriveEvents called <code>PatientArrival</code>, <code>ReceptionistArrival</code>, and <code>CTMachineArrival</code>, and set the PrototypeEntity to be the related entity (patient, receptionist, CTMachine).</p>
<p>We also need to create objects that represent the entities leaving, called LeaveEvent, we will only create one for the patients, as we are assuming that the receptionist and CT machines are available 24/7 so they do not need to leave. Drag and drop a leave event into the simulation, rename it <code>PatientLeave</code>, and set the Participant to be the patient entity (under the HCCM tab).</p>
<p>The patients waiting for check in and scanning, and both the receptionist and CT machines waiting for tasks can be represented by WaitActivities, so create four WaitActivities and rename them <code>WaitForCheckIn</code>, <code>WaitForScan</code>, <code>WaitForTaskReceptionist</code>, and <code>WaitForTaskCTMachine</code> respectively, and once again set the Participant to the respective entity.</p>
<p>We can then represent the patient doing check in with the receptionist, and the patient being scanned by a CT machine as process activities. Create two process activities and rename them <code>CheckIn</code>, and <code>Scan</code>.</p>
<p>We also need to create objects to represent the probability distributions that the interarrival, check in, and scan times come from. Probability distributions can be represented in Jaamsim with distribution objects. If we examine the PatientArrival object we see two keywords FirstArrivalTime and InterArrivalTime which determine the rate that the entities are created. For a Poisson process with an average of 8 arrivals per hour the interarrival times can be modelled by an exponential distribution with mean 0.125 hours. We therefore go into the Probability Distributions palette in the Model Builder window and create an ExponentialDistribution object and name it <code>ArrivalDistribution</code>. First we set the UnitType keyword to be <code>TimeUnit</code>, then we set the mean of the distribution to <code>0.125 h</code>. The UnitType tells Jaamsim what type of value we want the distribution object to create, in our case this is the time between arrivals in hours, which is a unit of time. Also make sure that the <code>RandomSeed</code> is 1, this determines the seed for the random number generator. <a href="#tbl-arr_dist" class="quarto-xref">Table&nbsp;<span>1.1</span></a> shows the keywords and values for the <code>ArrivalDistribution</code> object.</p>
<div id="tbl-arr_dist" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-arr_dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.1: Arrival Distribution Inputs
</figcaption>
<div aria-describedby="tbl-arr_dist-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<thead>
<tr class="header">
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Keyword</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ArrivalDistribution</td>
<td style="text-align: left;">UnitType</td>
<td style="text-align: left;">TimeUnit</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">RandomSeed</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">Mean</td>
<td style="text-align: left;">0.125 h</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>We need to repeat these steps for the check in and scan processes, which follow uniform and log-normal distributions respectively, so create a UniformDistribution object called <code>CheckInDistribution</code> and a <code>LogNormalDistribution</code> object called <code>ScanDistribution</code>. Then update the keywords of the distribution objects as follows in <a href="#tbl-serv_dists" class="quarto-xref">Table&nbsp;<span>1.2</span></a>:</p>
<div id="tbl-serv_dists" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-serv_dists-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.2: Check In and Scan Distributions
</figcaption>
<div aria-describedby="tbl-serv_dists-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<thead>
<tr class="header">
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Keyword</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CheckInDistribtuion</td>
<td style="text-align: left;">UnitType</td>
<td style="text-align: left;">TimeUnit</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">RandomSeed</td>
<td style="text-align: left;">2</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">MinValue</td>
<td style="text-align: left;">2 min</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">MaxValue</td>
<td style="text-align: left;">5 min</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ScanDistribution</td>
<td style="text-align: left;">UnitType</td>
<td style="text-align: left;">TimeUnit</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">RandomSeed</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">Scale</td>
<td style="text-align: left;">1 h</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">NormalMean</td>
<td style="text-align: left;">-1.34</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">NormalSD</td>
<td style="text-align: left;">0.29</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The final object we need at this stage is a Statistics object, to capture some output about the patients. This is found under the ProcessFlow palette, create a Statistics object and call it <code>TimeInSystem</code>.</p>
<p>At this point you should have the objects shown in <a href="#tbl-mod_objs" class="quarto-xref">Table&nbsp;<span>1.3</span></a> in your simulation.</p>
<div id="tbl-mod_objs" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-mod_objs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.3: Model Objects
</figcaption>
<div aria-describedby="tbl-mod_objs-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<thead>
<tr class="header">
<th style="text-align: left;">Object Type</th>
<th style="text-align: left;">Name</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">ActiveEntity</td>
<td style="text-align: left;">PatientEntity</td>
</tr>
<tr class="even">
<td style="text-align: left;">ActiveEntity</td>
<td style="text-align: left;">ReceptionistEntity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ActiveEntity</td>
<td style="text-align: left;">CTMachineEntity</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ArriveEvent</td>
<td style="text-align: left;">PatientArrival</td>
</tr>
<tr class="even">
<td style="text-align: left;">ArriveEvent</td>
<td style="text-align: left;">ReceptionistArrival</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ArriveEvent</td>
<td style="text-align: left;">CTMachineArrival</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">LeaveEvent</td>
<td style="text-align: left;">PatientLeave</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">WaitActivity</td>
<td style="text-align: left;">WaitForCheckIn</td>
</tr>
<tr class="even">
<td style="text-align: left;">WaitActivity</td>
<td style="text-align: left;">WaitForScan</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WaitActivity</td>
<td style="text-align: left;">WaitForTaskReceptionist</td>
</tr>
<tr class="even">
<td style="text-align: left;">WaitActivity</td>
<td style="text-align: left;">WaitForTaskCTMachine</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ProcessActivity</td>
<td style="text-align: left;">CheckIn</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ProcessActivity</td>
<td style="text-align: left;">Scan</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">ExponentialDistribution</td>
<td style="text-align: left;">ArrivalDistribution</td>
</tr>
<tr class="even">
<td style="text-align: left;">UniformDistribution</td>
<td style="text-align: left;">CheckInDistribution</td>
</tr>
<tr class="odd">
<td style="text-align: left;">LogNormalDistribution</td>
<td style="text-align: left;">ScanDistribution</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Statistics</td>
<td style="text-align: left;">TimeInSystem</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Once you have created all of these objects lay them out similarly to as shown in <a href="#fig-sim_pic" class="quarto-xref">Figure&nbsp;<span>1.2</span></a>.</p>
<div id="fig-sim_pic" class="quarto-figure quarto-figure-center quarto-float anchored page-columns page-full">
<figure class="quarto-float quarto-float-fig figure page-columns page-full">
<div aria-describedby="fig-sim_pic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca" class="page-columns page-full">
<img src="figures/Example_layout_2.png" class="img-fluid figure-img column-page-right">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-sim_pic-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.2: Screenshot of Simulation Model Layout
</figcaption>
</figure>
</div>
<p>Create a new folder in the ‘labs’ folder called ‘RC1’ and save your simulation as ‘radiology_lab.cfg’ or something similar inside the new folder. Also take this opportunity to change the graphics of the PatientEntity, ReceptionistEntity and CTMachineEntity. Download the patient.png, receptionist.png, and ctscanner.png (icons made by Freepik from www.flaticon.com) files from Canvas and save them in the same folder as your simulation .cfg file. Then in Jaamsim right click on PatientEntity and select Change Graphics. Click on Import and navigate to your downloaded patient.png, import it (it may be called patient-model) and accept the change. Repeat the process for the receptionists, and CT scanners.</p>
</section>
<section id="configuring-objects" class="level3" data-number="1.2.2">
<h3 data-number="1.2.2" class="anchored" data-anchor-id="configuring-objects"><span class="header-section-number">1.2.2</span> Configuring Objects</h3>
<p>Now that we have created the objects we need, we need to set the options for the each of them, starting with the ArriveEvents. The PatientArrival should have both the first arrival time and inter arrival times set by the ArrivalDistribution object, use the PatientEntity as a prototype, and the NextAEJObject should be WaitForCheckIn. NextAEJObject stands for next activity/event/Jaamsim object and refers to the fact that the next place an entity goes could be a standard Jaamsim object or a custom HCCM activity or event. For the arrive events we set NextAEJObject to the object that represents the activity that is transitioned to at the end of the event state changes in the conceptual model. For the ReceptionistArrival and CTMachineArrival we need to: set the prototype entity; both MaxNumber and InitialNumber (1 for receptionist, 3 for CT Machine); and set the NextAEJObject to the respective wait activity.</p>
<div id="tbl-arr_params" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-arr_params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.4: Arrival Event Parameters
</figcaption>
<div aria-describedby="tbl-arr_params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<thead>
<tr class="header">
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Tab</th>
<th style="text-align: left;">Keyword</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">PatientArrival</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">PrototypeEntity</td>
<td style="text-align: left;">PatientEntity</td>
</tr>
<tr class="even">
<td style="text-align: left;">PatientArrival</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">FirstArrivalTime</td>
<td style="text-align: left;">ArrivalDistribution</td>
</tr>
<tr class="odd">
<td style="text-align: left;">PatientArrival</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">InterArrivalTime</td>
<td style="text-align: left;">ArrivalDistribution</td>
</tr>
<tr class="even">
<td style="text-align: left;">PatientArrival</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">NextAEJObject</td>
<td style="text-align: left;">WaitForCheckIn</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">ReceptionistArrival</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">PrototypeEntity</td>
<td style="text-align: left;">ReceptionistEntity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ReceptionistArrival</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">MaxNumber</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;">ReceptionistArrival</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">InitialNumber</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">ReceptionistArrival</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">NextAEJObject</td>
<td style="text-align: left;">WaitForTaskReceptionist</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">CTMachineArrival</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">PrototypeEntity</td>
<td style="text-align: left;">CTMachineEntity</td>
</tr>
<tr class="even">
<td style="text-align: left;">CTMachineArrival</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">MaxNumber</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CTMachineArrival</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">InitialNumber</td>
<td style="text-align: left;">3</td>
</tr>
<tr class="even">
<td style="text-align: left;">CTMachineArrival</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">NextAEJObject</td>
<td style="text-align: left;">WaitForTaskCTMachine</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Next we will set the options for the Process Activities (and Statistics) so that the routing/flow for the entities is correct. The Check In activity has both the Patient and Receptionist as participants so we set the Participant list to PatientEntity, ReceptionistEntity. The duration is determined by the check in distribution, so we just set the duration to be CheckInDistribution object. After Check In the Patient starts waiting for a scan and the receptionist goes back to waiting for a task, so we set the NextAEJList to WaitForScan, WaitForTaskReceptionist. The Scan activity has both the Patient and CTMachine as participants and the duration is determined by the ScanDistribution object. After Scan the Patient should just leave, but we want to record some statistics first so we send it to TimeInSystem, and the CTMachine goes back to WaitForTaskCTMachine. For Process Activities the NextAEJList is similar to the NextAEJObject from the Arrive Events (which is similar to NextComponent), the difference is that a list of next objects is given, one for each of the participants in the activity. The participants are sent to the corresponding element of the list so it is important that the next activities are in the same order as the participants.</p>
<p>Note that when you click on the checkboxes in the popup menu for both ParticipantList and NextAEJList the items are added in alphabetical order, not the order you click them in. This is particularly important for the Scan activity as the CTMachineEntity comes before the PatientEntity alphabetically, but for the next activities TimeInSystem is before WaitForTaskCTMachine alphabetically so the two lists will not be in the same order.</p>
<div id="tbl-pro_params" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-pro_params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.5: Process Activity Parameters
</figcaption>
<div aria-describedby="tbl-pro_params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<thead>
<tr class="header">
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Tab</th>
<th style="text-align: left;">Keyword</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">CheckIn</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">Duration</td>
<td style="text-align: left;">CheckInDistribution</td>
</tr>
<tr class="even">
<td style="text-align: left;">CheckIn</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">ParticipantList</td>
<td style="text-align: left;">PatientEntity ReceptionistEntity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">CheckIn</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">NextAEJList</td>
<td style="text-align: left;">WaitForScan WaitForTaskReceptionist</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">Scan</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">Duration</td>
<td style="text-align: left;">ScanDistribution</td>
</tr>
<tr class="even">
<td style="text-align: left;">Scan</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">ParticipantList</td>
<td style="text-align: left;">PatientEntity CTMachineEntity</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Scan</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">NextAEJList</td>
<td style="text-align: left;">TimeInSystem WaitForTaskCTMachine</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>The last object we need to configure before the simulation will run (it will run but it will not quite work correctly) is the TimeInSystem object. This is a Statistics object which collects a value from each Entity that passes through it and outputs the mean of the sampled values. We then need to finish the routing so that patients leave after going through the TimeInSystem, and tell the Statistics object which value to record as shown in <a href="#tbl-stats" class="quarto-xref">Table&nbsp;<span>1.6</span></a>, note that <code>this</code> refers to the Statistics object itself, <code>obj</code> refers to the entity that the Statistics object is currently processing, and <code>TotalTime</code> is an output on the entity that stores the total time that the entity has been in the simulation for.</p>
<div id="tbl-stats" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.6: Collecting Statistics
</figcaption>
<div aria-describedby="tbl-stats-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<thead>
<tr class="header">
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Keyword</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">TimeInSystem</td>
<td style="text-align: left;">NextComponent</td>
<td style="text-align: left;">PatientLeave</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;">UnitType</td>
<td style="text-align: left;">TimeUnit</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;">SampleValue</td>
<td style="text-align: left;">this.obj.TotalTime</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Save your simulation again. If you run your simulation now you should see one receptionist arrive and wait, three CT machines arrive and wait, and patients arrive, and wait for check in. However nothing else will happen and all of the entities will simply be waiting, this is because we have not specified any logic to be triggered when the entities start waiting.</p>
</section>
</section>
<section id="model-logic-java" class="level2 page-columns page-full" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="model-logic-java"><span class="header-section-number">1.3</span> Model Logic – Java</h2>
<p>In your eclipse project you should have a folder called ‘sim_custom’ under the Project Explorer on the left hand side in Eclipse. First right-click on this folder and select New <span class="math inline">\(\rightarrow\)</span> Package. Enter <code>labs</code> for the name of the package and click Finish.</p>

<div class="no-row-height column-margin column-container"><div id="fig-create_package_1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-create_package_1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/create_new_package.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-create_package_1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.3: First Step in Creating a New Package
</figcaption>
</figure>
</div></div><div id="fig-create_package_2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-create_package_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/labs_package.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-create_package_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.4: Second Step in Creating a New Package
</figcaption>
</figure>
</div>
<p>Right click on the newly created labs package and select New <span class="math inline">\(\rightarrow\)</span> Class. Name the Class <code>RadiologyControlUnit</code> and enter <code>hccm.controlunits.ControlUnit</code> for the Superclass.</p>

<div class="no-row-height column-margin column-container"><div id="fig-create_class_1" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-create_class_1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/create_new_class.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-create_class_1-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.5: First Step in Creating a New Class
</figcaption>
</figure>
</div></div><div id="fig-create_class_2" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-create_class_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/control_unit_class_2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-create_class_2-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.6: Second Step in Creating a New Class
</figcaption>
</figure>
</div>
<p>What this has done is created a new Java class, based off the ControlUnit class, which we will use to implement the logic required for the clinic. The final step required to make this new object available in the simulation is to add to the contents of the sim_custom.inc file that we put in sim <span class="math inline">\(\rightarrow\)</span> hccm <span class="math inline">\(\rightarrow\)</span> jaamsim <span class="math inline">\(\rightarrow\)</span> src <span class="math inline">\(\rightarrow\)</span> main <span class="math inline">\(\rightarrow\)</span> resources <span class="math inline">\(\rightarrow\)</span> resources <span class="math inline">\(\rightarrow\)</span> inputs. There should already be some code there from the previous lab, so you only need to add lines 3, 7, and 10. If you want to copy and paste this make sure the quotes are copied correctly and the return (arrow) on line 10 is removed. Alternatively there is a new sim_custom.inc file on Canvas under Jaamsim Lab 1 that you can use directly.</p>
<!-- :::{.column-page-right} -->
<div class="sourceCode" id="cb1"><pre class="sourceCode numberSource default code-overflow-scroll number-lines code-with-copy"><code class="sourceCode default"><span id="cb1-1"><a href="#cb1-1"></a>Define ObjectType {</span>
<span id="cb1-2"><a href="#cb1-2"></a>    FIFOQControlUnit</span>
<span id="cb1-3"><a href="#cb1-3"></a>    RadiologyControlUnit</span>
<span id="cb1-4"><a href="#cb1-4"></a>}</span>
<span id="cb1-5"><a href="#cb1-5"></a></span>
<span id="cb1-6"><a href="#cb1-6"></a>ControllerIconModel ImageFile { '&lt;res&gt;/images/Controller-256.png' }  Transparent { TRUE }</span>
<span id="cb1-7"><a href="#cb1-7"></a>AssembleIconModel ImageFile { '&lt;res&gt;/images/Assemble-256.png' }  Transparent { TRUE }</span>
<span id="cb1-8"><a href="#cb1-8"></a></span>
<span id="cb1-9"><a href="#cb1-9"></a>FIFOQControlUnit JavaClass { ssq.FIFOQControlUnit }  Palette { 'Single Server Queue' } DefaultDisplayModel { ControllerIconModel } IconFile { '&lt;res&gt;/images/Controller-24.png' } DefaultSize { 0.5 0.5 0.5 m }</span>
<span id="cb1-10"><a href="#cb1-10"></a>RadiologyControlUnit JavaClass { labs.RadiologyControlUnit }  Palette { 'Custom Logic' } DefaultDisplayModel { AssembleIconModel } IconFile { '&lt;res&gt;/images/Assemble-24.png' } DefaultSize { 0.5 0.5 0.5 m }</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<!-- ::: -->
<p>Once you have updated the sim_custom.inc file, clean your project and restart Jaamsim. If everything is working correctly the RadiologyControlUnit object should now be available under the Custom Logic palette as shown in the screenshot below:</p>
<div id="fig-cu_obj" class="quarto-figure quarto-figure-center quarto-float anchored">
<figure class="quarto-float quarto-float-fig figure">
<div aria-describedby="fig-cu_obj-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<img src="figures/control_unit_jaamsim_2.png" class="img-fluid figure-img">
</div>
<figcaption class="quarto-float-caption-bottom quarto-float-caption quarto-float-fig" id="fig-cu_obj-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Figure&nbsp;1.7: Screenshot of Control Unit Object
</figcaption>
</figure>
</div>
<p>Once you have the new RadiologyControlUnit object available open your simulation and create one.</p>
<p>We now need to add the Java code to the new RadiologyControlUnit class to run the control policies. First add the following imports under the package declaration. <strong>Note</strong> These code snippets for this lab are provided in a separate file for you</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb2-1"><a href="#cb2-1"></a><span class="kw">package</span><span class="im"> labs</span><span class="op">;</span></span>
<span id="cb2-2"><a href="#cb2-2"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">ArrayList</span><span class="op">;</span></span>
<span id="cb2-3"><a href="#cb2-3"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">Arrays</span><span class="op">;</span></span>
<span id="cb2-4"><a href="#cb2-4"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">Collections</span><span class="op">;</span></span>
<span id="cb2-5"><a href="#cb2-5"></a><span class="kw">import</span> <span class="im">java</span><span class="op">.</span><span class="im">util</span><span class="op">.</span><span class="im">List</span><span class="op">;</span></span>
<span id="cb2-6"><a href="#cb2-6"></a></span>
<span id="cb2-7"><a href="#cb2-7"></a><span class="kw">import</span> <span class="im">hccm</span><span class="op">.</span><span class="im">activities</span><span class="op">.</span><span class="im">ProcessActivity</span><span class="op">;</span></span>
<span id="cb2-8"><a href="#cb2-8"></a><span class="kw">import</span> <span class="im">hccm</span><span class="op">.</span><span class="im">controlunits</span><span class="op">.</span><span class="im">ControlUnit</span><span class="op">;</span></span>
<span id="cb2-9"><a href="#cb2-9"></a><span class="kw">import</span> <span class="im">hccm</span><span class="op">.</span><span class="im">entities</span><span class="op">.</span><span class="im">ActiveEntity</span><span class="op">;</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Then, within the definition of the class we need to create four methods that represent the four control policies in the model. Each control policy is a public method of the class that does not return any value (is void) and takes both a list of Active Entities, and the simulation time as inputs. We will use the same names for the methods as the control policies in the conceptual model: <code>OnStartWaitForCheckIn</code>, <code>OnStartWaitForScan</code>, <code>OnStartWaitForTaskReceptionist</code>, and <code>OnStartWaitForTaskCTMachine</code>. In the first of these, <code>OnStartWaitForCheckIn</code> we first need to get a list of the Receptionist Entities that are currently in the ’’WaitForTaskReceptionist” activity, and we also create a comparator object that is used to sort a list of entities by when they started their current activity.</p>
<p>Once we have the list of idle receptionists we check whether it is not empty, and if it isn’t proceed to sort it, select the first one, and transition the patient and receptionist to the check in activity.</p>
<div class="column-page-right">
<div class="sourceCode" id="cb3"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb3-1"><a href="#cb3-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">OnStartWaitForCheckIn</span><span class="op">(</span><span class="bu">List</span><span class="op">&lt;</span>ActiveEntity<span class="op">&gt;</span> ents<span class="op">,</span> <span class="dt">double</span> simTime<span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-2"><a href="#cb3-2"></a>        </span>
<span id="cb3-3"><a href="#cb3-3"></a>    <span class="bu">ArrayList</span><span class="op">&lt;</span>ActiveEntity<span class="op">&gt;</span> idleReceps <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getEntitiesInActivity</span><span class="op">(</span><span class="st">"ReceptionistEntity"</span><span class="op">,</span> <span class="st">"WaitForTaskReceptionist"</span><span class="op">,</span> simTime<span class="op">);</span></span>
<span id="cb3-4"><a href="#cb3-4"></a>    ActivityStartCompare actSartComp <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">new</span> <span class="fu">ActivityStartCompare</span><span class="op">();</span>        </span>
<span id="cb3-5"><a href="#cb3-5"></a>    </span>
<span id="cb3-6"><a href="#cb3-6"></a>    <span class="cf">if</span> <span class="op">(</span>idleReceps<span class="op">.</span><span class="fu">size</span><span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb3-7"><a href="#cb3-7"></a>      <span class="bu">Collections</span><span class="op">.</span><span class="fu">sort</span><span class="op">(</span>idleReceps<span class="op">,</span> actSartComp<span class="op">);</span></span>
<span id="cb3-8"><a href="#cb3-8"></a>      </span>
<span id="cb3-9"><a href="#cb3-9"></a>      ActiveEntity patient <span class="op">=</span> ents<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb3-10"><a href="#cb3-10"></a>      ActiveEntity receptionist <span class="op">=</span> idleReceps<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb3-11"><a href="#cb3-11"></a>      </span>
<span id="cb3-12"><a href="#cb3-12"></a>      <span class="fu">transitionTo</span><span class="op">(</span><span class="st">"CheckIn"</span><span class="op">,</span> patient<span class="op">,</span> receptionist<span class="op">);</span></span>
<span id="cb3-13"><a href="#cb3-13"></a>    <span class="op">}</span></span>
<span id="cb3-14"><a href="#cb3-14"></a>  <span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Similar methods are defined for the other control policies, with small changes based on the types of entities that are being checked, and the activity that is started. There are gaps that need to be filled in on lines 3, 24, and 42. In the first gap you need to create an array that contains all of the CT Machines that are currently idle. In the second, you need to select which of the patients that are currently waiting should do check in with the receptionist. In the third, you need to start the next activity with the patient and CT Machine. All of these have similar lines in the first method that you can use as a guide.</p>
<div class="column-page-right">
<div class="sourceCode" id="cb4"><pre class="sourceCode numberSource java number-lines code-with-copy"><code class="sourceCode java"><span id="cb4-1"><a href="#cb4-1"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">OnStartWaitForScan</span><span class="op">(</span><span class="bu">List</span><span class="op">&lt;</span>ActiveEntity<span class="op">&gt;</span> ents<span class="op">,</span> <span class="dt">double</span> simTime<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-2"><a href="#cb4-2"></a>  </span>
<span id="cb4-3"><a href="#cb4-3"></a>    <span class="co">// A //</span></span>
<span id="cb4-4"><a href="#cb4-4"></a>    ActivityStartCompare actSartComp <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">new</span> <span class="fu">ActivityStartCompare</span><span class="op">();</span>        </span>
<span id="cb4-5"><a href="#cb4-5"></a>    </span>
<span id="cb4-6"><a href="#cb4-6"></a>    <span class="cf">if</span> <span class="op">(</span>idleCTs<span class="op">.</span><span class="fu">size</span><span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-7"><a href="#cb4-7"></a>      <span class="bu">Collections</span><span class="op">.</span><span class="fu">sort</span><span class="op">(</span>idleCTs<span class="op">,</span> actSartComp<span class="op">);</span></span>
<span id="cb4-8"><a href="#cb4-8"></a>      </span>
<span id="cb4-9"><a href="#cb4-9"></a>      ActiveEntity patient <span class="op">=</span> ents<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb4-10"><a href="#cb4-10"></a>      ActiveEntity ct <span class="op">=</span> idleCTs<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb4-11"><a href="#cb4-11"></a></span>
<span id="cb4-12"><a href="#cb4-12"></a>      <span class="fu">transitionTo</span><span class="op">(</span><span class="st">"Scan"</span><span class="op">,</span> patient<span class="op">,</span> ct<span class="op">);</span></span>
<span id="cb4-13"><a href="#cb4-13"></a>    <span class="op">}</span></span>
<span id="cb4-14"><a href="#cb4-14"></a>  <span class="op">}</span></span>
<span id="cb4-15"><a href="#cb4-15"></a>    </span>
<span id="cb4-16"><a href="#cb4-16"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">OnStartWaitForTaskReceptionist</span><span class="op">(</span><span class="bu">List</span><span class="op">&lt;</span>ActiveEntity<span class="op">&gt;</span> ents<span class="op">,</span> <span class="dt">double</span> simTime<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-17"><a href="#cb4-17"></a>      </span>
<span id="cb4-18"><a href="#cb4-18"></a>  <span class="bu">ArrayList</span><span class="op">&lt;</span>ActiveEntity<span class="op">&gt;</span> waitPats <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getEntitiesInActivity</span><span class="op">(</span><span class="st">"PatientEntity"</span><span class="op">,</span> <span class="st">"WaitForCheckIn"</span><span class="op">,</span> simTime<span class="op">);</span></span>
<span id="cb4-19"><a href="#cb4-19"></a>  ActivityStartCompare actSartComp <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">new</span> <span class="fu">ActivityStartCompare</span><span class="op">();</span>        </span>
<span id="cb4-20"><a href="#cb4-20"></a>  </span>
<span id="cb4-21"><a href="#cb4-21"></a>  <span class="cf">if</span> <span class="op">(</span>waitPats<span class="op">.</span><span class="fu">size</span><span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-22"><a href="#cb4-22"></a>    <span class="bu">Collections</span><span class="op">.</span><span class="fu">sort</span><span class="op">(</span>waitPats<span class="op">,</span> actSartComp<span class="op">);</span></span>
<span id="cb4-23"><a href="#cb4-23"></a>    </span>
<span id="cb4-24"><a href="#cb4-24"></a>    <span class="co">// B //</span></span>
<span id="cb4-25"><a href="#cb4-25"></a>    ActiveEntity receptionist <span class="op">=</span> ents<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb4-26"><a href="#cb4-26"></a></span>
<span id="cb4-27"><a href="#cb4-27"></a>    <span class="fu">transitionTo</span><span class="op">(</span><span class="st">"CheckIn"</span><span class="op">,</span> patient<span class="op">,</span> receptionist<span class="op">);</span></span>
<span id="cb4-28"><a href="#cb4-28"></a>  <span class="op">}</span></span>
<span id="cb4-29"><a href="#cb4-29"></a><span class="op">}</span></span>
<span id="cb4-30"><a href="#cb4-30"></a></span>
<span id="cb4-31"><a href="#cb4-31"></a><span class="kw">public</span> <span class="dt">void</span> <span class="fu">OnStartWaitForTaskCTMachine</span><span class="op">(</span><span class="bu">List</span><span class="op">&lt;</span>ActiveEntity<span class="op">&gt;</span> ents<span class="op">,</span> <span class="dt">double</span> simTime<span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-32"><a href="#cb4-32"></a>  </span>
<span id="cb4-33"><a href="#cb4-33"></a>  <span class="bu">ArrayList</span><span class="op">&lt;</span>ActiveEntity<span class="op">&gt;</span> waitPats <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">getEntitiesInActivity</span><span class="op">(</span><span class="st">"PatientEntity"</span><span class="op">,</span> <span class="st">"WaitForScan"</span><span class="op">,</span> simTime<span class="op">);</span></span>
<span id="cb4-34"><a href="#cb4-34"></a>  ActivityStartCompare actSartComp <span class="op">=</span> <span class="kw">this</span><span class="op">.</span><span class="fu">new</span> <span class="fu">ActivityStartCompare</span><span class="op">();</span>        </span>
<span id="cb4-35"><a href="#cb4-35"></a>    </span>
<span id="cb4-36"><a href="#cb4-36"></a>  <span class="cf">if</span> <span class="op">(</span>waitPats<span class="op">.</span><span class="fu">size</span><span class="op">()</span> <span class="op">&gt;</span> <span class="dv">0</span><span class="op">)</span> <span class="op">{</span></span>
<span id="cb4-37"><a href="#cb4-37"></a>    <span class="bu">Collections</span><span class="op">.</span><span class="fu">sort</span><span class="op">(</span>waitPats<span class="op">,</span> actSartComp<span class="op">);</span></span>
<span id="cb4-38"><a href="#cb4-38"></a>    </span>
<span id="cb4-39"><a href="#cb4-39"></a>    ActiveEntity patient <span class="op">=</span> waitPats<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb4-40"><a href="#cb4-40"></a>    ActiveEntity ct <span class="op">=</span> ents<span class="op">.</span><span class="fu">get</span><span class="op">(</span><span class="dv">0</span><span class="op">);</span></span>
<span id="cb4-41"><a href="#cb4-41"></a></span>
<span id="cb4-42"><a href="#cb4-42"></a>    <span class="co">// C //</span></span>
<span id="cb4-43"><a href="#cb4-43"></a>  <span class="op">}</span></span>
<span id="cb4-44"><a href="#cb4-44"></a><span class="op">}</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The final step needed to get this logic into the simulation is to define Triggers that initiate these methods and where/when they should be called. To do this create four Trigger objects, called <code>StartWaitCheckIn</code>, <code>StartWaitScan</code>, <code>StartWaitTaskReceptionist</code>, and <code>StartWaitTaskCTMachine</code> from the HCCM palette and set the ControlUnit and ControlPolicy for each one. The value of the ControlPolicy keyword needs to exactly match the name of the method you have defined in the java code.</p>
<div id="tbl-trig_params" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-trig_params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.7: Trigger Parameters
</figcaption>
<div aria-describedby="tbl-trig_params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<thead>
<tr class="header">
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Tab</th>
<th style="text-align: left;">Keyword</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">StartWaitCheckIn</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">ControlUnit</td>
<td style="text-align: left;">RadiologyControlUnit1</td>
</tr>
<tr class="even">
<td style="text-align: left;">StartWaitCheckIn</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">ControlPolicy</td>
<td style="text-align: left;">OnStartWaitForCheckIn</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">StartWaitScan</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">ControlUnit</td>
<td style="text-align: left;">RadiologyControlUnit1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">StartWaitScan</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">ControlPolicy</td>
<td style="text-align: left;">OnStartWaitForScan</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">StartWaitTaskReceptionist</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">ControlUnit</td>
<td style="text-align: left;">RadiologyControlUnit1</td>
</tr>
<tr class="even">
<td style="text-align: left;">StartWaitTaskReceptionist</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">ControlPolicy</td>
<td style="text-align: left;">OnStartWaitForTaskReceptionist</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">StartWaitTaskCTMachine</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">ControlUnit</td>
<td style="text-align: left;">RadiologyControlUnit1</td>
</tr>
<tr class="odd">
<td style="text-align: left;">StartWaitTaskCTMachine</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">ControlPolicy</td>
<td style="text-align: left;">OnStartWaitForTaskCTMachine</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Then update the parameters in the Wait Activities that these control policies should be triggered in:</p>
<div id="tbl-wait_params" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-wait_params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.8: Wait Activity Parameters
</figcaption>
<div aria-describedby="tbl-wait_params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<thead>
<tr class="header">
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Tab</th>
<th style="text-align: left;">Keyword</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">WaitForCheckIn</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">StartTriggerList</td>
<td style="text-align: left;">StartWaitCheckIn</td>
</tr>
<tr class="even">
<td style="text-align: left;">WaitForCheckIn</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">StartTriggerChoice</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">WaitForScan</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">StartTriggerList</td>
<td style="text-align: left;">StartWaitScan</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WaitForScan</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">StartTriggerChoice</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="even">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="odd">
<td style="text-align: left;">WaitForTaskReceptionist</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">StartTriggerList</td>
<td style="text-align: left;">StartWaitTaskReceptionist</td>
</tr>
<tr class="even">
<td style="text-align: left;">WaitForTaskReceptionist</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">StartTriggerChoice</td>
<td style="text-align: left;">1</td>
</tr>
<tr class="odd">
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
<td style="text-align: left;"></td>
</tr>
<tr class="even">
<td style="text-align: left;">WaitForTaskCTMachine</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">StartTriggerList</td>
<td style="text-align: left;">StartWaitTaskCTMachine</td>
</tr>
<tr class="odd">
<td style="text-align: left;">WaitForTaskCTMachine</td>
<td style="text-align: left;">HCCM</td>
<td style="text-align: left;">StartTriggerChoice</td>
<td style="text-align: left;">1</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Now if you save and run your simulation you should be able to see patients arriving, checking in, being scanned, and leaving. If you get an error saying that a method cannot be found on the control unit, first make sure that all of the ControlPolicy inputs exactly match the names of the methods in the control unit java file. Then try closing Jaamsim, cleaning your project, and restarting Jaamsim.</p>
</section>
<section id="model-output" class="level2" data-number="1.4">
<h2 data-number="1.4" class="anchored" data-anchor-id="model-output"><span class="header-section-number">1.4</span> Model Output</h2>
<p>To perform different experiments and multiple replications we make use of Jaamsim’s MultipleRuns feature which can be found in the Simulation object at the top of the Object Selector window. Here we can use the <code>NumberOfReplications</code> to control how many replications are performed. We want to do 50 replications so we set NumberOfReplications to 50. We want each replication to run for one week, so we set RunDuration to <code>7d</code>. To record outputs we can make use of the Simulation object’s RunOutputList, which saves the final value of outputs at the end of each run. The scenario number, and the replication number are saved by default (by default PrintRunLabels and PrintReplications are TRUE), but we will calculate confidence intervals ourselves so we set PrintConfidenceIntervals to FALSE. Because ActiveEntities are removed from the simulation when they enter a LeaveEvent, we cannot get the total time that each patient spends in the clinic at the end of the run. This is why we created a Statistics object called TimeInSystem that records how long they have been in the system before they are destroyed. We can use the SampleAverage output of the TimeInSystem object in the Simulation’s RunOutputList to output the mean time in system for each replication. <strong>Note</strong> The SampleAverage is divided by 1[h] to give a raw number in hours for later processing in R. Otherwise JaamSim writes an h to the data file.</p>
<div id="tbl-sim_params" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sim_params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.9: Simulation Parameters
</figcaption>
<div aria-describedby="tbl-sim_params-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<thead>
<tr class="header">
<th style="text-align: left;">Object</th>
<th style="text-align: left;">Tab</th>
<th style="text-align: left;">Keyword</th>
<th style="text-align: left;">Value</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Simulation</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">RunDuration</td>
<td style="text-align: left;">7 d</td>
</tr>
<tr class="even">
<td style="text-align: left;">Simulation</td>
<td style="text-align: left;">Key Inputs</td>
<td style="text-align: left;">RunOutputList</td>
<td style="text-align: left;">{‘[TimeInSystem].SampleAverage / 1[h]’}</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Simulation</td>
<td style="text-align: left;">Multiple Runs</td>
<td style="text-align: left;">NumberOfReplications</td>
<td style="text-align: left;">50</td>
</tr>
<tr class="even">
<td style="text-align: left;">Simulation</td>
<td style="text-align: left;">Multiple Runs</td>
<td style="text-align: left;">PrintConfidenceIntervals</td>
<td style="text-align: left;">FALSE</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Now if you save and run your simulation a file should be created called ‘yourSimulationName.dat’. To speed up running the simulation you can turn off the option ‘Real time’, in the top left corner next to the play button.</p>
<p>With the model complete and the results recorded we can use R to analyse them. First download the R analysis file provided, then change the working directory and name of the .dat and .log files to match yours, then run the R file. The following table should be printed:</p>
<div id="tbl-sim_output" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-sim_output-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.10: R Output
</figcaption>
<div aria-describedby="tbl-sim_output-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<tbody>
<tr class="odd">
<td style="text-align: left;">lower95CI</td>
<td style="text-align: left;">mean</td>
<td style="text-align: left;">upper95CI</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.442</td>
<td style="text-align: left;">0.449</td>
<td style="text-align: left;">0.457</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
</section>
<section id="task" class="level2" data-number="1.5">
<h2 data-number="1.5" class="anchored" data-anchor-id="task"><span class="header-section-number">1.5</span> Task</h2>
<p>Construct a 95% confidence interval for the average utilisation of the three CT machines in each experiment. You should get the following output:</p>
<div id="tbl-task_output" class="sm quarto-float anchored">
<figure class="quarto-float quarto-float-tbl figure">
<figcaption class="quarto-float-caption-top quarto-float-caption quarto-float-tbl" id="tbl-task_output-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
Table&nbsp;1.11: Task Output
</figcaption>
<div aria-describedby="tbl-task_output-caption-0ceaefa1-69ba-4598-a22c-09a6ac19f8ca">
<table class="table-sm small table">
<tbody>
<tr class="odd">
<td style="text-align: left;">lower95CI</td>
<td style="text-align: left;">mean</td>
<td style="text-align: left;">upper95CI</td>
</tr>
<tr class="even">
<td style="text-align: left;">0.724</td>
<td style="text-align: left;">0.731</td>
<td style="text-align: left;">0.737</td>
</tr>
</tbody>
</table>
</div>
</figure>
</div>
<p>Hint: there are many ways to do this. Have a look at the outputs provided on the wait activity <code>WaitForTaskCTMachine</code>, can you calculate the total time that the three CTMachines have spent waiting using these outputs?</p>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="../../index.html" class="pagination-link" aria-label="Preface">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="../../chapters/lab_1_cm/lab_1_cm.html" class="pagination-link" aria-label="Radiology Clinic Lab -- Conceptual Model">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">Radiology Clinic Lab – Conceptual Model</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->
    <script type="text/javascript">
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        let pseudocodeOptions = {
          indentSize: el.dataset.indentSize || "1.2em",
          commentDelimiter: el.dataset.commentDelimiter || "//",
          lineNumber: el.dataset.lineNumber === "true" ? true : false,
          lineNumberPunc: el.dataset.lineNumberPunc || ":",
          noEnd: el.dataset.noEnd === "true" ? true : false,
          titlePrefix: el.dataset.algTitle || "Algorithm"
        };
        pseudocode.renderElement(el.querySelector(".pseudocode"), pseudocodeOptions);
      });
    })(document);
    (function(d) {
      d.querySelectorAll(".pseudocode-container").forEach(function(el) {
        titleSpan = el.querySelector(".ps-root > .ps-algorithm > .ps-line > .ps-keyword")
        titlePrefix = el.dataset.algTitle;
        titleIndex = el.dataset.chapterLevel ? el.dataset.chapterLevel + "." + el.dataset.pseudocodeIndex : el.dataset.pseudocodeIndex;
        titleSpan.innerHTML = titlePrefix + " " + titleIndex + " ";
      });
    })(document);
    </script>
  




</body></html>